# Описание доменной модели  (Prosolve.Services.IdentificationDomain)


## Как мы создаем новый сервис?
Тащимся в Trello и создаем себе карточку со следующим чек листом:
1. Составляем единый общий язык (Ubiquitous language)
2. Определяем список Entity/ValueObject
3. Определяем Saga/Activity
3. Составление концептуальной схемы для модели данных
4. Определяем список бизнес процессов (Business Process)
5. Определяем список технологических процессов (Technological Process)

Пример:

### Ubiquitous language

Выписываем все слова связанные с нашим сервисом.

|Название||Тип|Описание|
|---|---|---|---|
|Пользователь|User|--/--|Пользователь информационной системы|
|Политика|Policy|--/--|Правило для доступа к функциональности|
|Роль пользователя|Role|--/--|Роль пользователя в информационной системе|
|Пользовательский профиль|Profile|--/--|Дополнительная информация по пользователю|
|Идентификация|Identification|--/--|Присвоение пользователю идентификатора и/или сравнение идентификатора с перечнем присвоенных идентификаторов|--/--|
|Авторизация|Authorization|--/--|Предоставление этому лицу возможностей в соответствие с положенными ему правами или проверка наличия прав при попытке выполнить какое-либо действие|
|Аутентификация|Authentication|--/--|Подтверждение подлинности пользователя|
|Регистрация|Registration|--/--|Создание нового пользователя|
|Блокировка пользователя|Locking|--/--|Временная блокировка пользователя|
|Отключение пользователя|Deregistration|--/--|Полное отключение пользователя, без возможности восстановления|
|Восстановление аккаунта|Recovery|--/--|Процедура восстановление доступа к сервису|
|Пароль|Password|--/--|Пароль пользователя для входа в систему|
|Время жизни пароля|Password lifetime|--/--|Время жизни текущего пароля|
|Фамилия|Surname|--/--|Фамилия пользователя|
|Имя|FirstName|--/--|Имя пользователя|
|Отчество|Patronymic|--/--|Отчество пользователя|
|Соль|Salt|--/--|Соль для хранения пароля|
|Добавление роли|Adding role|--/--||
|Изменение роли|Modification role|--/--||
|Блокировка роли|Locking role|--/--||
|Удаление роли|Deletion role|--/--||
|Добавление политики|Adding policy|--/--||
|Изменение политики|Modification policy|--/--||
|Блокировка политики|Locking policy|--/--||
|Удаление политики|Deletion policy|--/--||
|Тип регистрации|Registration Type|--/--|Тип регистрации Email/Phone|
|Источник регистрации|Registration Source|--/--|Тип регистрации Mobile/Site|
|Адрес электронной почты|EmailAddress|--/--|Адрес почты указанной при регистрации |
|Адрес электронной почты|Phone|--/--|Номер телефона указанного при регистрации |
|Дата последнего посещения|--/--|Дата указывающая на дату последнего события сделанного клиентом|

### Анализируем под Domain Driven Design

Определяем что из наших слов является Entity и Value Object. 
    
Entity - Объект, суть которого определяется не его атрибутами,  а непрерывностью существования и идентификации.

Value Object -  Нет уникального идентификатора, неизменный, имеет короткий жизненный цикл, не имеет собственной таблицы в базе данных. 

Помним что слова должны быть существительными. После этого сортируем список. Entity и Value Object наверх.

|Название||Тип|Описание|
|---|---|---|---|
|Пользователь|User|Entity|Пользователь информационной системы|
|Статус пользователя|UserState|Entity|Статус пользователя: Активный/Неактивный/Заблокированный|
|Политика|Policy|Entity|Правило для доступа к функциональности|
|Роль пользователя|Role|Entity|Роль пользователя в информационной системе|
|Статус роли|RoleState|Entity|Состояние роли на текущий момент: Активная/Неактивная|
|Пользовательский профиль|Profile|Entity|Дополнительная информация по пользователю|
|Тип регистрации|Registration Type|Entity|Тип регистрации Email/Phone|
|Источник регистрации|Registration Source|Entity|Тип регистрации Mobile/Site|
|Адрес электронной почты|EmailAddress|Value Object|Адрес почты указанной при регистрации |
|Адрес электронной почты|Phone|Value Object|Номер телефона указанного при регистрации |
|Пароль|Password|Value Object|Пароль пользователя для входа в систему|
|Время жизни пароля|Password lifetime|Value Object|Время жизни текущего пароля|
|Фамилия|Surname|Value Object|Фамилия пользователя|
|Имя|FirstName|Value Object|Имя пользователя|
|Отчество|Patronymic|Value Object|Отчество пользователя|
|Соль|Salt|Value Object|Соль для хранения пароля|
|Идентификация|Identification|--/--|Присвоение пользователю идентификатора и/или сравнение идентификатора с перечнем присвоенных идентификаторов|--/--|
|Авторизация|Authorization|--/--|Предоставление этому лицу возможностей в соответствие с положенными ему правами или проверка наличия прав при попытке выполнить какое-либо действие|
|Аутентификация|Authentication|--/--|Подтверждение подлинности пользователя|
|Регистрация|Registration|--/--|Создание нового пользователя|
|Блокировка пользователя|Locking|--/--|Временная блокировка пользователя|
|Отключение пользователя|Deregistration|--/--|Полное отключение пользователя, без возможности восстановления
|Восстановление аккаунта|Recovery|--/--|Процедура восстановление доступа к сервису|
|Добавление роли|Adding role|--/--||
|Изменение роли|Modification role|--/--||
|Блокировка роли|Locking role|--/--||
|Удаление роли|Deletion role|--/--||
|Добавление политики|Adding policy|--/--||
|Изменение политики|Modification policy|--/--||
|Блокировка политики|Locking policy|--/--||
|Удаление политики|Deletion policy|--/--||

### Анализируем под MicroServices

Сейчас нам надо определить сколько у нас будет Saga и Activity. Все что у нас осталось это саги.
https://www.lshnk.me/2018/01/14/%D1%80%D0%B5%D0%B0%D0%BB%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F-%D0%BF%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D0%B0-saga-%D0%BD%D0%B0-c/

Saga - это шаблон управления сбоями. Saga появилась из осознания того, что долгоживущие транзакции (первоначально даже транзакции внутри базы данных), и особенно далеко распределенные транзакции, пересекающие границы местоположения и / или доверия, не могут быть обработаны с использованием классической модели ACID с двухфазной фиксацией и удерживанием блокировки на время работы (2PC). Вместо этого сага разбивает работу на отдельные транзакции, результаты которых могут быть каким-то образом отменены после того, как работа выполнена и совершена.

|Название||Тип|Описание|
|---|---|---|---|
|Пользователь|User|Entity|Пользователь информационной системы|
|Статус пользователя|UserState|Entity|Статус пользователя: Активный//Неактивный/Заблокированный|
|Политика|Policy|Entity|Правило для доступа к функциональности|
|Роль пользователя|Role|Entity|Роль пользователя в информационной системе|
|Статус роли|RoleState|Entity|Состояние роли на текущий момент: Активная/Неактивная|
|Пользовательский профиль|Profile|Entity|Дополнительная информация по пользователю|
|Тип регистрации|Registration Type|Entity|Тип регистрации Email/Phone|
|Источник регистрации|Registration Source|Entity|Тип регистрации Mobile/Site|
|Адрес электронной почты|EmailAddress|Value Object|Адрес почты указанной при регистрации |
|Адрес электронной почты|Phone|Value Object|Номер телефона указанного при регистрации |
|Пароль|Password|Value Object|Пароль пользователя для входа в систему|
|Время жизни пароля|Password lifetime|Value Object|Время жизни текущего пароля|
|Фамилия|Surname|Value Object|Фамилия пользователя|
|Имя|FirstName|Value Object|Имя пользователя|
|Отчество|Patronymic|Value Object|Отчество пользователя|
|Соль|Salt|Value Object|Соль для хранения пароля|
|Идентификация|Identification|Activity|Присвоение пользователю идентификатора и/или сравнение идентификатора с перечнем присвоенных идентификаторов|
|Авторизация|Authorization|Saga|Предоставление этому лицу возможностей в соответствие с положенными ему правами или проверка наличия прав при попытке выполнить какое-либо действие|
|Аутентификация|Authentication|Saga|Подтверждение подлинности пользователя|
|Регистрация|Registration|Saga|Создание нового пользователя|
|Блокировка пользователя|Locking|Saga|Временная блокировка пользователя|
|Отключение пользователя|Deregistration|Saga|Полное отключение пользователя, без возможности восстановления
|Восстановление аккаунта|Recovery|Saga|Процедура восстановление доступа к сервису|
|Добавление роли|Adding role|Saga||
|Изменение роли|Modification role|Saga||
|Блокировка роли|Locking role|Saga||
|Удаление роли|Deletion role|Saga||
|Добавление политики|Adding policy|Saga||
|Изменение политики|Modification policy|Saga||
|Блокировка политики|Locking policy|Saga||
|Удаление политики|Deletion policy|Saga||

Декомпозируем Saga на Activity:
Авторизация             = AssertPolicy =>
Аутентификация          = 
Регистрация             = AssertNumberOfAttempts => IdentificationActivity => SaveContact(ContactService) => SendMailActivity (EmailService) => ContactConfirmation (ContactService) => UserActivate  
                                                                                                          => SendSmsActivity  (SMSService)   =>
Блокировка пользователя = AssertNumberOfAttempts => AssertPolicy =>
Отключение пользователя
Восстановление аккаунта
Добавление роли
Изменение роли
Блокировка роли                                                                                                                                                                          
Удаление роли
Добавление политики
Изменение политики
Блокировка политики
Удаление политики